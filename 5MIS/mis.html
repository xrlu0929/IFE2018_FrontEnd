<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">    
    <title>MIS</title>
</head>
<body>

<h4>信息查询表</h4>
<select id="region-select" onChange="write_table()"></select>
<p></p>
<div id="table-wrapper">
</div>

    
<script src="ife31data.js"></script>   
<script>
    //write options
    let source_length = sourceData.length
    //group region
    var option_region =["华东", "华西", "华南", "华北", "华中"]
    
    function options() {
        var selector_text = ''
        var selector = document.querySelector("#region-select") 
        var i = 0;
        for (i; i < option_region.length; i++) {
//            document.write("<option value='" + option_region[i] + "'>")
            selector_text = selector_text + "<option>" + option_region[i] + "</option>"
        }
        selector.innerHTML = selector_text
       
    }
    
    options()
    
    // select region
    var region = document.querySelector("#region-select")
    
    function get_region(){
        
        var reindex = region.selectedIndex
        var retxt = region.options[reindex].text
        console.log(retxt)
        return retxt
    }
    
    
    function select_region() {
        var selectedData = []
        var retxt = get_region()
        
        for(i=0;i<source_length;i++){
            if(sourceData[i].region == retxt){
                selectedData.push(sourceData[i])
            }
        }
        console.log(selectedData)
        return selectedData
    }

    function write_table(){
        //options()
        var text = '<table ><tr><th>产品</th><th>产地</th><th>销量</th></tr>'
        text = text + '<tr><th></th><th></th>'
        for (var i = 0; i < 12; i++) {
            text = text + '<th>' + (i+1) +'</th>'
        }
        text = text + '</tr>'
        var selectedData = select_region()
        
        for (var i = 0; i < selectedData.length ; i++) {
            text = text +'<tr><th>'+ selectedData[i].product + '</th><th>' + selectedData[i].region+'</th>'
            for (var j = 0; j < 12; j++) {
                console.log(selectedData[i].sale)
                text = text + '<th>'+selectedData[i].sale[j] + '</th>'
            }
            text = text + '</tr>'
            
            console.log(selectedData[i].product)
            console.log(selectedData[i].region)
            
        }
        text = text + '</table>'
        var table = document.querySelector("#table-wrapper") 
        table.innerHTML=text
    }
    
</script>
</body>